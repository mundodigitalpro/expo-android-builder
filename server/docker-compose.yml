version: '3.8'

services:
  expo-builder:
    build: .
    container_name: expo-builder
    restart: unless-stopped
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - HOST=0.0.0.0
      - AUTH_TOKEN=${AUTH_TOKEN}
      - PROJECTS_BASE_PATH=/app-builder-projects
      - ANDROID_HOME=/opt/android-sdk
      - JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
      - PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/android-sdk/cmdline-tools/latest/bin:/opt/android-sdk/platform-tools:/usr/lib/jvm/java-17-openjdk-amd64/bin
    volumes:
      # Montar proyectos (persistencia)
      - app-builder-projects:/app-builder-projects
      # Montar Android SDK desde el host (read-only)
      - /opt/android-sdk:/opt/android-sdk:ro
      # NOTA: Java ahora est√° instalado DENTRO del contenedor, no se monta desde el host
    networks:
      - builder-network

volumes:
  app-builder-projects:
    driver: local

networks:
  builder-network:
    driver: bridge
