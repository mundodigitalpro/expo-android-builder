version: '3.8'
services:
  expo-builder:
    build: .
    container_name: expo-builder
    restart: unless-stopped
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - PORT=3001
      - HOST=0.0.0.0
      - AUTH_TOKEN=${AUTH_TOKEN}
      - PROJECTS_BASE_PATH=/app-builder-projects
      - ANDROID_HOME=/opt/android-sdk
      - JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - GITHUB_REPO_OWNER=${GITHUB_REPO_OWNER}
      - GITHUB_REPO_NAME=${GITHUB_REPO_NAME}
      - GIT_USER_NAME=Expo Builder
      - GIT_USER_EMAIL=builder@josejordan.dev
      - CLAUDE_CONFIG_DIR=/home/node/.claude
      - CLAUDE_NO_TELEMETRY=1
      - EXPO_TOKEN=${EXPO_TOKEN}
    volumes:
      - app-builder-projects:/app-builder-projects
      - /opt/android-sdk:/opt/android-sdk:rw
      - /home/josejordan/apps/builder:/repo:rw
      - /home/josejordan/.claude:/home/node/.claude:rw
    working_dir: /repo/server
    networks:
      - builder-network
volumes:
  app-builder-projects:
    driver: local
networks:
  builder-network:
    driver: bridge
